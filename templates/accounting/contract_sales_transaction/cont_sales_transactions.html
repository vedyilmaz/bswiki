{% extends "layout.html" %}
{% load humanize %}
{% load mathfilters %}
{% block body %}

    <div class="container-fluid">
        <div class="input-group mb-3">
          <div class="input-group-prepend">
              <form>
                  <h3>Contract Sales Transactions</h3>
                  <p>&nbsp;</p>
                  {% csrf_token %}
          </div>
            </form>
        </div>

    <div class="input-group mb-3">
              <div class="input-group-prepend">
                  <form>
                    {% csrf_token %}
                    <button class="btn btn-secondary" type="submit">Search</button>
              </div>
                  <input type="text" name="keyword" class="form-control" placeholder="Input a keyword ..." aria-label="" aria-describedby="basic-addon1">
                </form>
        </div>

    {% if not cont_sales_transactions %}
        <div class="alert alert-danger" style = "margin-top:20px;">There is no contract sale transaction yet.</div>
    </div>
    {% else %}
        <table class="table table-hover" style="margin-top:20px;">
            <thead>
                <tr>
                    <th scope="col">id</th>
                    <th scope="col">Invoice</th>
                    <th scope="col">Contract</th>
                    <th scope="col">Date</th>
                    <th scope="col">Amount</th>
                    <th scope="col">Currency</th>
                    <th scope="col">Bank Account</th>
                    <th scope="col">Total Amount</th>
                </tr>
            </thead>
            <tbody>
                {% for cs in cont_sales_transactions  %}
                    <tr>
<!--                        <th scope="row">{{ cs.id }}</th>-->
                        <td><a title="Transaction details" href="{% url 'accounting:cont_sales_transaction_detail' cs.id %}#container">{{ cs.id }}</a></td>
                        <td><a title="Invoice details" href="{% url 'accounting:cont_sale_invoice_detail' cs.invoice %}#container">{{ cs.invoice__invoice_number }}</a></td>
                        <td><a title="Contract details" href="{% url 'accounting:contract_detail' cs.invoice__contract__id %}#container">{{ cs.invoice__contract__contract_alias }}</a></td>
                        <td>{{ cs.date }}</td>
                        <td>{{ cs.amount }}</td>
                        <td>{{ cs.invoice__sales__contract__currency }}</td>
                        <td>{{ cs.bank_account__account_alias }}</td>
                        <td><a href="{% url 'accounting:update_cont_sales_transaction' cs.id %}">Update</a></td>
                        <td><a class="confirm-delete" href="{% url 'accounting:delete_cont_sales_transaction' cs.id %}">Delete</a></td>
                    </tr>
                {% endfor %}

            </tbody>
        </table>
    <script>
    $(document).on('click', '.confirm-delete', function(){
        return confirm('Are you sure you want to delete this?');
    })

    function getElement(elm){
        return document.getElementById(elm);
    }

    function removeClass(elm, class_name){
        var stat = elm.classList.contains("disabled");
        if (stat == true) {
            elm.classList.remove(class_name);
            console.log("class name removed:" + class_name);
        }
    }

    var matches = document.querySelectorAll('.radioPayoff');
    for (match in matches) {
      matches[match].onclick = function() {
        console.log(this.value);
        var btn_payoff = getElement('id_btn_payoff');
        removeClass(btn_payoff, "disabled");
      }
    }

    </script>
        
    {% endif %}
{% endblock body %}